
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Dynaconf: The Python Settings Siver Bullet!" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://carlosneto.dev/in-progress/2024-07-20-dynaconf-extension/" />
<meta property="og:site_name" content="Carlos Neto" />
<meta property="og:description" content="Blog Post Publish Date: 2024/07/21 This blog post outlines how to extending the Dynaconf to load parameters from multiple and costum sources. Good Practices in Application Settings: The definitivel..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="https://carlosneto.dev/_images/social_previews/summary_in-progress_2024-07-20-dynaconf-extension_f403fff7.png" />
<meta property="og:image:alt" content="Blog Post Publish Date: 2024/07/21 This blog post outlines how to extending the Dynaconf to load parameters from multiple and costum sources. Good Practices..." />
<meta name="description" content="Blog Post Publish Date: 2024/07/21 This blog post outlines how to extending the Dynaconf to load parameters from multiple and costum sources. Good Practices in Application Settings: The definitivel..." />
<meta name="twitter:card" content="summary_large_image" />

    <title>Dynaconf: The Python Settings Siver Bullet! &#8212; Carlos Neto&#39;s Tech Blog</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-examples.css?v=e236af4b" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=68e62335" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=187304be"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'in-progress/2024-07-20-dynaconf-extension';</script>
    <link rel="icon" href="../../_static/profile-color-circle-small.png"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

<link
  rel="alternate"
  type="application/atom+xml"
  href="../../blog/atom.xml"
  title="Carlos Neto"
/>



  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search/"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this site..."
         aria-label="Search this site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../">
  
  
  
  
  
  
    <p class="title logo__title">Carlos Neto's Tech Blog</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../blog/">
    Blog
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../whoami/">
    whoami
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/c-neto" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/in/c-neto/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://carlosneto.dev/blog/atom.xml" title="Blog RSS feed" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-rss fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Blog RSS feed</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../blog/">
    Blog
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../whoami/">
    whoami
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/c-neto" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/in/c-neto/" title="LinkedIn" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-linkedin fa-lg" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://carlosneto.dev/blog/atom.xml" title="Blog RSS feed" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-rss fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Blog RSS feed</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none"></div>
              
              

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
<p><i class="fa fa-calendar"></i> <em><strong>Blog Post Publish Date:</strong> 2024/07/21</em></p>
<hr class="docutils" />
<section id="dynaconf-the-python-settings-siver-bullet">
<h1>Dynaconf: The Python Settings Siver Bullet!<a class="headerlink" href="#dynaconf-the-python-settings-siver-bullet" title="Link to this heading">#</a></h1>
<p>This blog post outlines how to extending the Dynaconf to load parameters from multiple and costum sources.</p>
<section id="good-practices-in-application-settings">
<h2>Good Practices in Application Settings<a class="headerlink" href="#good-practices-in-application-settings" title="Link to this heading">#</a></h2>
<p>The definitively best practice guide for Application settings is the <a class="reference external" href="https://12factor.net/config">12 Factor</a> definition. In summary, the guide emphasizes the separation of config from code and suggets a set parametrization based on environments needs.</p>
<p>Like almost recurring generic needs and best practices well defined, there are some modules and framework for help us.</p>
<p>In Python world, there are some tools that can help you to achieve these best practices. I can refer some nice tools like <a class="reference external" href="https://github.com/theskumar/python-dotenv">python-dotenv</a>, (<em>focused in reads simple key-value pairs from a .env file and can set them as environment variables</em>), and <a class="reference external" href="https://github.com/HBNetwork/python-decouple">python-decouple</a> (<em>helps provide a dynamic settings interface to can help to change parameters without having to redeploy your app, useful for web applications</em>). Besides that, there are built-in modules for parse structured files that can be use as a settings files, like <a class="reference external" href="https://docs.python.org/3/library/tomllib.html#module-tomllib">tomllib</a>, <a class="reference external" href="https://docs.python.org/3/library/shlex.html#module-shlex">shlex</a>, <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json">json</a>.</p>
<p>These modules are really nice, and had your specific use case, mainly with you can use minative approach and simple programs like routine scripts. But, with the provocative blog post title, I will present the Dynaconf.</p>
</section>
<section id="dynaconf">
<h2>Dynaconf<a class="headerlink" href="#dynaconf" title="Link to this heading">#</a></h2>
<p>The Dyanconf is more robust module for settings in Python. Your design are created for strict follow 12 Factor config principles. We can understand the Dynaconf as an abstraction layer between code and settings providing a robust and simple code interface.</p>
<p>The main features for me are support from most common settings file format (toml|yaml|json|ini|py), multi and hirarchcal profiles support (like default, development, testing, production), mulitple settings source support useful for isolate sensitive information, environment variable input support (take precedence over than others settings source following the Unix philosophy). In addition, there are a CLI useful for debug or export values.</p>
<p>Dyanconf have built-in support for external parameter/secrets storage system like Hashicorp Vault and Redis. But the Dynaconf provide a extending interface to use any sources based on your needs. This feature is really awesome! I will show an example how to do it.</p>
</section>
<section id="talk-is-cheap-show-me-the-code">
<h2>Talk is cheap, Show me the code!<a class="headerlink" href="#talk-is-cheap-show-me-the-code" title="Link to this heading">#</a></h2>
<p>Create a virtual environment and install dependencies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate
pip3<span class="w"> </span>install<span class="w"> </span>dynaconf<span class="w"> </span>boto3<span class="w"> </span>
</pre></div>
</div>
<p>Inits a dynaconf project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dynaconf<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span><span class="nv">PARAMETER_FROM_SETTINGS_TOML_FILE</span><span class="o">=</span><span class="s2">&quot;foobar from settings.toml&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-s<span class="w"> </span><span class="nv">PARAMETER_FROM_SECRETS_TOML_FILE</span><span class="o">=</span><span class="s2">&quot;foobar from .secrets.toml&quot;</span>
</pre></div>
</div>
<p>The previous command will create the following files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>├──<span class="w"> </span>config.py<span class="w">       </span><span class="c1"># python module that have dynaconf instance</span>
├──<span class="w"> </span>.secrets.toml<span class="w">   </span><span class="c1"># settings files that have: PARAMETER_FROM_SECRETS_TOML_FILE</span>
└──<span class="w"> </span>settings.toml<span class="w">   </span><span class="c1"># settings files that have: PARAMETER_FROM_SETTINGS_TOML_FILE</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">config.py</span></code> source code is:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">config.py</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dynaconf</span> <span class="kn">import</span> <span class="n">Dynaconf</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">Dynaconf</span><span class="p">(</span>
    <span class="n">envvar_prefix</span><span class="o">=</span><span class="s2">&quot;DYNACONF&quot;</span><span class="p">,</span>
    <span class="n">settings_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;settings.toml&#39;</span><span class="p">,</span> <span class="s1">&#39;.secrets.toml&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Use the dynaconf-cli to list parameters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>dynaconf<span class="w"> </span>-i<span class="w"> </span>config.settings<span class="w"> </span>list<span class="w"> </span>

<span class="c1"># &gt;&gt;&gt; Working in main environment </span>
<span class="c1">#</span>
<span class="c1"># PARAMETER_FROM_SETTINGS_TOML_FILE&lt;str&gt; &#39;foobar from settings.toml&#39;</span>
<span class="c1"># PARAMETER_FROM_SECRETS_TOML_FILE&lt;str&gt; &#39;foobar from .secrets.toml&#39;</span>
</pre></div>
</div>
<p>Configure AWS Environment Variables to access the Localstack container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="nb">test</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="nb">test</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ENDPOINT_URL</span><span class="o">=</span>http://localhost:4566
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>us-east-1
</pre></div>
</div>
<p>Put two parameters in AWS Parameter Store to use in Dynaconf.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>ssm<span class="w"> </span>put-parameter<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;/my-application/PARAMETER_FROM_AWS_PARAMETER_STORE_1&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--value<span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--type<span class="w"> </span><span class="s2">&quot;SecureString&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--endpoint-url<span class="w"> </span>http://localhost:4566

aws<span class="w"> </span>ssm<span class="w"> </span>put-parameter<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;/my-application/PARAMETER_FROM_AWS_PARAMETER_STORE_2&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--value<span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--type<span class="w"> </span><span class="s2">&quot;SecureString&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--endpoint-url<span class="w"> </span>http://localhost:4566
</pre></div>
</div>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> with the following content:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">config.py</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span><span class="p">,</span> <span class="n">BotoCoreError</span>
<span class="kn">from</span> <span class="nn">dynaconf</span> <span class="kn">import</span> <span class="n">Dynaconf</span><span class="p">,</span> <span class="n">LazySettings</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Configure logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_aws_parameter_store_loader</span><span class="p">(</span><span class="n">parameters_prefix</span><span class="o">=</span><span class="s2">&quot;/my-application/&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">ssm_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ssm&#39;</span><span class="p">)</span>

    <span class="n">paginator</span> <span class="o">=</span> <span class="n">ssm_client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s2">&quot;get_parameters_by_path&quot;</span><span class="p">)</span>
    <span class="n">parameters_from_aws</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="n">Path</span><span class="o">=</span><span class="n">parameters_prefix</span><span class="p">,</span> <span class="n">Recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">WithDecryption</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;Parameters&quot;</span><span class="p">]:</span>
            <span class="n">param_name_full</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
            <span class="n">param_value</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">param_name</span> <span class="o">=</span> <span class="n">param_name_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Parameter name pattern outside of expected format, skipping: &quot;</span><span class="si">{param_name_full}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">parameters_from_aws</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

    <span class="k">return</span> <span class="n">parameters_from_aws</span>


<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">LazySettings</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">parameters_from_aws</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters loaded from AWS Parameter Store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">parameters_from_aws</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parameters_from_aws</span><span class="p">)</span>


<span class="c1"># Attempt to load parameters from AWS Parameter Store and update Dynaconf loaders</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">parameters_from_aws</span> <span class="o">=</span> <span class="n">_aws_parameter_store_loader</span><span class="p">(</span><span class="n">ssm_client</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="n">BotoCoreError</span><span class="p">,</span> <span class="n">ClientError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">LOADERS_FOR_DYNACONF</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dynaconf.loaders.env_loader&quot;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;AWS active session not detected, skipping load parameters from AWS Parameter Store&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">LOADERS_FOR_DYNACONF</span> <span class="o">=</span> <span class="p">[</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;dynaconf.loaders.env_loader&quot;</span><span class="p">]</span>

<span class="c1"># Initialize Dynaconf settings with specified files and loaders</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">Dynaconf</span><span class="p">(</span>
    <span class="n">settings_files</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;settings.toml&quot;</span><span class="p">,</span> <span class="s2">&quot;.secrets.toml&quot;</span><span class="p">],</span>
    <span class="n">envvar_prefix</span><span class="o">=</span><span class="s2">&quot;MY_APP&quot;</span><span class="p">,</span>
    <span class="n">LOADERS_FOR_DYNACONF</span><span class="o">=</span><span class="n">LOADERS_FOR_DYNACONF</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, check the variables and note the <code class="docutils literal notranslate"><span class="pre">PARAMETER_FROM_AWS_PARAMETER_STORE_1</span></code> and <code class="docutils literal notranslate"><span class="pre">PARAMETER_FROM_AWS_PARAMETER_STORE_2</span></code> that was retrivied from AWS Parameter Store</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>dynaconf<span class="w"> </span>-i<span class="w"> </span>config.settings<span class="w"> </span>list

<span class="c1"># &gt;&gt;&gt; output</span>
<span class="c1">#</span>
<span class="c1"># PARAMETER_FROM_SETTINGS_TOML_FILE&lt;str&gt; &#39;foobar from settings.toml&#39;</span>
<span class="c1"># PARAMETER_FROM_SECRETS_TOML_FILE&lt;str&gt; &#39;foobar from .secrets.toml&#39;</span>
<span class="c1"># PARAMETER_FROM_AWS_PARAMETER_STORE_1&lt;str&gt; &#39;foo&#39;</span>
<span class="c1"># PARAMETER_FROM_AWS_PARAMETER_STORE_2&lt;str&gt; &#39;bar&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">MY_APP_PARAMETER_FROM_AWS_PARAMETER_STORE_2</span><span class="o">=</span><span class="s2">&quot;param from environment variable&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>dynaconf<span class="w"> </span>-i<span class="w"> </span>config.settings<span class="w"> </span>list

<span class="c1"># &gt;&gt;&gt; output</span>
<span class="c1">#</span>
<span class="c1"># PARAMETER_FROM_SETTINGS_TOML_FILE&lt;str&gt; &#39;foobar from settings.toml&#39;</span>
<span class="c1"># PARAMETER_FROM_SECRETS_TOML_FILE&lt;str&gt; &#39;foobar from .secrets.toml&#39;</span>
<span class="c1"># PARAMETER_FROM_AWS_PARAMETER_STORE_1&lt;str&gt; &#39;foo&#39;</span>
<span class="c1"># PARAMETER_FROM_AWS_PARAMETER_STORE_2&lt;str&gt; &#39;param from environment variable&#39;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>I created a lab to exemplify how to use Dynaconf with multiple parameter sources, including custom loaders to retrieve parameters from AWS Parameter Store: <i class="fab fa-github"></i> <em><a class="reference external" href="https://github.com/c-neto/my-code-playground/tree/main/blog-code-examples/2024-07-20-dynaconf-loaders">github.com/c-neto/my-code-playground/blog-code-examples/2024-07-20-dynaconf-loaders</a></em></p>
</div>
</section>
<section id="links">
<h2>Links<a class="headerlink" href="#links" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://12factor.net">https://12factor.net</a></p></li>
<li><p><a class="reference external" href="https://12factor.net/config">https://12factor.net/config</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/json.html">https://docs.python.org/3/library/json.html</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/shlex.html">https://docs.python.org/3/library/shlex.html</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/tomllib.html">https://docs.python.org/3/library/tomllib.html</a></p></li>
<li><p><a class="github reference external" href="https://github.com/c-neto/my-code-playground/tree/main/blog-code-examples/2024-07-20-dynaconf-loaders">c-neto/my-code-playground</a></p></li>
<li><p><a class="github reference external" href="https://github.com/HBNetwork/python-decouple">HBNetwork/python-decouple</a></p></li>
<li><p><a class="github reference external" href="https://github.com/theskumar/python-dotenv">theskumar/python-dotenv</a></p></li>
</ul>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

                </article>
              
<!-- Add a comment box underneath the page's content -->
<script 
  src="https://giscus.app/client.js"
  data-repo="c-neto/carlosneto.dev"
  data-repo-id="R_kgDOKgwGNA"
  data-category="General"
  data-category-id="DIC_kwDOKgwGNM4CaKBI"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="light"
  data-lang="en"
  crossorigin="anonymous"
  async>
</script>

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023, Carlos Neto.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>